datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                        String          @id @default(uuid())
  createdAt                 DateTime        @default(now())

  email                     String?         @unique
  username                  String?         @unique

  paymentProcessorUserId    String?         @unique
  lemonSqueezyCustomerPortalUrl String?     // You can delete this if you're not using Lemon Squeezy as your payments processor.
  subscriptionStatus        String?         // 'active', 'cancel_at_period_end', 'past_due', 'deleted'
  subscriptionPlan          String?         // 'hobby', 'pro'
  datePaid                  DateTime?
  credits                   Int             @default(0)
  videoCredits              Int             @default(0)  // Credits for video generation

  gptResponses              GptResponse[]
  contactFormMessages       ContactFormMessage[]
  tasks                     Task[]
  files                     File[]
  videoGenerations          VideoGeneration[]
}

model GptResponse {
  id                        String          @id @default(uuid())
  createdAt                 DateTime        @default(now())
  updatedAt                 DateTime        @updatedAt

  user                      User            @relation(fields: [userId], references: [id])
  userId                    String

  content                   String
}

model Task {
  id                        String          @id @default(uuid())
  createdAt                 DateTime        @default(now())

  user                      User            @relation(fields: [userId], references: [id])
  userId                    String

  description               String
  time                      String          @default("1")
  isDone                    Boolean         @default(false)
}

model File {
  id                        String          @id @default(uuid())
  createdAt                 DateTime        @default(now())

  user                      User            @relation(fields: [userId], references: [id])
  userId                    String

  name                      String
  type                      String
  key                       String
  uploadUrl                 String
}


model ContactFormMessage {
  id                        String          @id @default(uuid())
  createdAt                 DateTime        @default(now())

  user                      User            @relation(fields: [userId], references: [id])
  userId                    String

  content                   String
  isRead                    Boolean         @default(false)
  repliedAt                 DateTime?
}

enum VideoStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

model VideoGeneration {
  id                    String   @id @default(uuid())
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  
  user                 User     @relation(fields: [userId], references: [id])
  userId               String
  
  // Input from user
  referenceImageUrl    String   // S3 URL of uploaded reference image
  content              String   // User's description/prompt
  
  // Generated content URLs
  generatedImageUrl    String?  // Fal.ai generated image
  finalVideoUrl        String?  // Final video S3 URL
  thumbnailUrl         String?  // Video thumbnail
  
  // Status tracking
  status               VideoStatus @default(PENDING)
  progress             Int      @default(0)    // 0-100
  
  // Fixed for this workflow
  duration             Int      @default(8)    // Always 8 seconds
  aspectRatio          String   @default("9:16") // Portrait
  
  // Metadata
  fileSize             Int?     // bytes
  s3Key                String?  // S3 storage key
  n8nExecutionId       String?  // n8n workflow execution ID
  
  @@index([userId, createdAt])
}
